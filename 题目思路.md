


# 任务一｜数据分析与“共性特征”提取（重中之重）

## 1. 数据读取与标准化（解决变量名&采样率差异）

**目标**：把源域（12/48 kHz、≈1797 rpm）与目标域（32 kHz、≈600 rpm）都转成“统一物理语义”的数据与元信息，便于后续稳健抽特征与迁移。

- **统一 loader（MATLAB 或 Python 都行）**
  
    - 映射变量名：把 `.mat` 中的 `*_DE_time / *_FE_time / *_BA_time / *RPM` 规范成 `DE/FE/BA/RPM` 四个键；缺失通道置空并记录 `missing mask`。
      
    - 记录元信息：`fs`（采样率）、`RPM`、`位置(DE/FE/BA)`、`故障类型(IR/OR/B/N)`、`缺陷尺寸`、`文件路径`。
      
    - 切片：统一**1.0 s 窗口、50% 重叠**切段（目标域 8s → 8段；源域按总时长切），每段单独做特征。
    
- **处理采样率不一致（12/48 ↔ 32 kHz）**
  
    - **物理特征**统一在**Hz 或阶次（order）**空间提取（与采样率无关）。
      
    - 若要给深度模型波形/时频图输入，做**抗混叠重采样**到统一率（建议 32 kHz），但**不强制**：能用物理/频域特征时，直接在 Hz/阶次轴计算即可。
    
- **处理转速差异（≈1797 rpm ↔ ≈600 rpm）**
  
    - 计算轴频 fr=RPM/60f_r=\mathrm{RPM}/60，把频率特征再映射到**阶次**：order=f/fr\text{order}=f/f_r。  
        例如内圈 BPFI 在源域 ≈162 Hz、目标域 ≈54 Hz，但**阶次是同一个数**（约5.x阶）。这就是跨速“共性”的关键。
        

---

## 2. 预处理（稳健、简单、可解释）

- 基本处理：去均值、去趋势（或高通 10–20 Hz）、**标准化**（每段减均值/除标准差）。
  
- **带通（解调预处理）**：
  
    - 源域 12 kHz：带通 **1–5 kHz** 起步；48 kHz：**2–10 kHz**；目标域 32 kHz：**1.5–8 kHz**。
      
    - 频带不是死的：先用**谱峭度（SK）或调谐谱峭度（TK）**在候选带宽里找“最脉冲化”的频段，再固定该带做 Hilbert 包络。
    
- **Hilbert 包络**：对带通信号做包络，得到解调信号 e(t)=∣H{xbp(t)}∣e(t)=|\mathcal{H}\{x_{bp}(t)\}|。
  

> **为什么这些处理靠谱？**  
> 轴承故障是**冲击+调制**型信号：冲击激发高频共振→包络里呈现**BPFI/BPFO/BSF**等特征频率及其倍频、**±k·f_r**侧带。带通+包络=把与故障最相关的“周期冲击”放大出来，且**跨工况稳定**。

---

## 3. “共性”特征设计（既有物理意义，又足够稳健）

**宗旨**：让不同采样率/转速/位置的样本，在这个特征空间里**可比**、**可对齐**。

### 3.1 物理频谱/包络谱特征（Hz & 阶次两套）

- **理论频率**（由轴承几何 + RPM）：BPFI、BPFO、BSF、FTF。  
    每条切片，计算包络谱 Pe(f)P_e(f) 后，提取：
    
    1. **主峰幅值与SNR**：在理论 ±Δ（如 ±10%）窗口内的峰值、与邻域噪声比。
       
    2. **倍频能量**（2×/3×/… 的能量和/出现个数）。
       
    3. **侧带能量与对称性**：BPF\*±kfr,k=1,2BPF\* \pm k f_r, k=1,2 的能量总和与左右差。
       
    4. **峰位偏差**：Δf=f^−ftheory\Delta f = \hat{f}-f_{\text{theory}} 及其对阶次的偏差 Δorder\Delta \text{order}。
    
- **映射到阶次**：将同一批特征在**order 轴**再算一份（对跨速最友好）。
  

### 3.2 稳健统计/谱结构特征

- **谱峭度（SK）/调谐谱峭度（TK）**：最优频带中心与宽度、对应峰值（反映脉冲性）。
  
- **带宽能量箱**：在固定频带如 [0.5,1]、[1,2]、…[0.5,1]、[1,2]、… kHz 计算能量（对噪声/不同fs稳）。
  
- **倒谱峰**：调制周期峰（与侧带周期对应），可强化内圈/外圈判据。
  
- **循环谱（可选）**：在循环频率 α=BPF*\alpha = \text{BPF*} 的谱相关密度（抗噪强）。
  

### 3.3 时域补充（简单但有用）

- RMS、峰-峰、峭度、冲击/裕度因子、Teager能量均值/方差。
  

> **落地建议**：  
> 选 **80–150 维** 左右的组合：  
> **(物理类 ~40)** + **(统计/谱结构 ~30)** + **(时域 ~10)** + **(阶次版再拷贝关键物理特征 ~20)**。  
> 再加上**RPM** 和 **fs 标签**作为“条件变量”（供后续对齐/模型使用）。

---

## 4. 源/目标域差异测度与可视化（给迁移“指路”）

- **UMAP/t-SNE**：可视化源/目标在特征空间是否可混、同类是否可聚。
  
- **简单域可分性**：用一个小的逻辑回归/浅层MLP做“域分类器”，准确率越高→域差越大。
  
- **分布差指标**：
  
    - **均值/协方差差（CORAL）**：∥μs−μt∥,∥Σs−Σt∥\| \mu_s-\mu_t \|, \| \Sigma_s-\Sigma_t \|；
      
    - **MMD**（高斯核）：衡量源/目标分布距离。  
        这些数都写进报告，后面迁移时用来对齐并验证“对齐有没有起作用”。
        

---

## 5. 源域样本筛选（构建“更像目标”的源子集）

- 按**RPM接近**、**位置相近（DE优先）**、**缺陷类型匹配**先筛一遍；
  
- 再用上面的**MMD/CORAL 距离**或**域分类器置信度**对源样本打“相似度分”，保留 Top-x% 做“源核心集”，其余做低权重样本（见任务3“样本加权”）。
  

---

# 任务二｜源域故障诊断（先把源域跑稳）

**目的**：在任务一的“共性特征”上，训练一个**强可解释基线** + 一个**深度对照**，为迁移打地基。

- **数据划分**：分层 5 折（按故障类型、位置分层），留出“跨采样率”的验证折（例如训练用12k，验证含48k，检验鲁棒）。
  
- **模型A（可解释基线）**：**XGBoost/LightGBM**
  
    - 训练：特征标准化 + 类别权重（若不平衡）
      
    - 指标：Macro-F1、每类召回、混淆矩阵
      
    - **解释**：**SHAP** 排前15特征（你会看到 BPFI/BPFO/BSF 的主峰/侧带等物理项靠前）
    
- **模型B（深度对照，可选）**：简单 **1D-CNN**（波形/包络输入，重采样到 32 kHz）或 **CWT-2D + 轻量CNN**
  
    - 指标同上；保留以便迁移时做表征对齐。
      

> **为什么树模型？**  
> 物理特征+树模型**稳、快、可解释**，工况小漂移也抗；深度对照是为了任务3做特征层对齐时有“表征骨干”。

---

# 任务三｜迁移诊断（基于任务2的模型+任务1的特征）

我们用**容易落地的“三段式”**，不用复杂花哨：

## 3.1 特征层对齐（基于特征的迁移）

- **CORAL**：在训练时加入
  
    L=Lsrc_cls+λ∥μs−μt∥2+∥Σs−Σt∥F2⏟CORALL = L_\text{src\_cls} + \lambda \underbrace{\|\mu_s-\mu_t\|^2 + \|\Sigma_s-\Sigma_t\|_F^2}_{\text{CORAL}}
    
    用目标域的**无标签**特征做对齐；λ\lambda 从 0.1～1 网格挑。
    
- **MMD（可互换）**：若你熟悉核方法，用 MMD 同步做均值对齐。
  
- **条件化**：把 **RPM（fr）** 和 **fs标签**拼到特征末尾（或做条件BN），帮助模型“知道”两个域的工况差。
  

> **实现**：最简单做法是把任务2的**树模型**换成一个**小MLP**（2～3层），损失里加一项 CORAL/MMD，对源做有监督训练、对源+目标的中间层做无监督对齐。**易写、效果稳定**。

## 3.2 样本加权（基于样本的迁移）

- 计算源样本到目标域中心的 MMD/CORAL 距离或“域分类器相似度”，得到权重 wi∈[0,1]w_i\in[0,1]。
  
- 训练中把源样本的分类损失加权：∑iwiLi\sum_i w_i L_i。**直觉：更像目标的源样本学得更用力**。
  

## 3.3 少量伪标签微调（温和版）

- 用对齐后的模型给目标域样本打分，选**置信度≥0.95**的样本加入训练（源+少量目标），1～2轮即可；每轮放宽到 0.90。
  
- 加**一致性正则**（同一目标样本做两种弱增强，预测要一致）防止漂移。
  

## 3.4 输出与可视化（检验迁移是否“真发生”）

- **UMAP前后对比**：对齐前/后的分布图；
  
- **MMD/CORAL曲线**：训练轮次 vs 分布差；
  
- **域分类器准确率**：从高（好区分）降到接近 50%（不可分）说明对齐有效；
  
- 目标域的**标签、置信度直方图**和**混淆矩阵（若有真值）**。
  

---

# 任务四｜可解释性（事前 / 过程 / 事后）

- **事前可解释**（模型/特征自解释）：
  
    - 用任务2的**树模型 + 物理特征**作为“白盒基线”（SHAP + 物理频率/阶次图谱），解释“为什么是这个判定”。
    
- **迁移过程可解释**：
  
    - 报告**MMD/CORAL 曲线**、**域分类器准确率下降**、**UMAP前后**；
      
    - 展示几个目标样本**包络谱**在对齐前后的差异（目标类峰更突出/侧带更对称）。
    
- **事后可解释**：
  
    - 树模型：**SHAP力图**展示单样本判据（如“BPFI主峰+侧带占比”推动它是IR）；
      
    - 深度支路（若用CWT图）：**Grad-CAM**热区映射回物理频带/阶次，说明模型在看哪段频带的何种模式。
      

---

## 交付清单与里程碑（建议）

1. **任务1报告**：
   
    - 数据画像（fs、RPM、位置、故障分布）；
      
    - 特征定义与**合理性说明**（包络谱/侧带/阶次等）；
      
    - 域差测度（UMAP、MMD/CORAL、域分类器）。
    
2. **任务2模型**：
   
    - XGBoost/LightGBM结果 + SHAP；
      
    - 深度对照（可选）。
    
3. **任务3迁移**：
   
    - CORAL/MMD 对齐 + 样本加权 + 伪标签迭代；
      
    - 指标提升、可视化与消融（去掉对齐/加权/伪标签分别怎样）。
    
4. **任务4解释**：
   
    - SHAP + Grad-CAM + 过程曲线与对比图。
      

---

## 一页速用的“技术选型理由”

- **带通+包络**：直接放大“周期冲击”的载波调制，**物理机理直连**（IR/B/OR/FTF）。
  
- **谱峭度选带**：从数据里找“最脉冲”的带宽，**比固定带更稳**。
  
- **阶次特征**：把频率除以轴频，**一招化解跨转速**；侧带 ±k·fr 进一步区分 IR/OR。
  
- **树模型+SHAP**：**可解释、快**、工程稳定；适合把物理特征变成“能讲清楚的判据”。
  
- **CORAL/MMD**：**实现容易**、效果稳定，能看得见“对齐有没有发生”。
  
- **样本加权+伪标签**：不用大改网络，**小手术提升**目标域效果。
  

---

## 小小落地提示（实操顺序）

1. 先把**任务1**特征做全、做稳（尤其是 BPFI/BPFO/BSF 的主峰/倍频/侧带&阶次）。
   
2. 用这些特征在**源域**把树模型跑到**Macro-F1≥95%**（常见数据能拿到）；
   
3. 再加上 **CORAL/MMD 对齐 + 样本加权** 去做**目标域**，看指标与可视化；
   
4. 最后补上**解释性**可视化与过程指标，就能把报告讲“圆”。
   
